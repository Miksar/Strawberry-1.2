
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<title>Strawberry // Readme</title>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<link href="_tpl/style.css" rel="stylesheet" type="text/css" media="screen">
</head>

<body>

<h1>Оглавление</h1>
<ul>
<li><a href="#Информация о скрипте">Информация о скрипте</a></li>
<li><a href="#Системные требования">Системные требования</a></li>
<li><a href="#Установка  Strawberry">Установка  Strawberry</a></li>
<li><a href="#Переезд с CuteNews.RU 02x, CuteNews и AJ-Fork">Переезд с CuteNews.RU 02x, CuteNews и AJ-Fork</a></li>
<li><a href="#Обновление скрипта">Обновление скрипта</a></li>
<li><a href="#Миграция с txtSQL (тектовой версии) на MySQL">Миграция с txtSQL (тектовой версии) на MySQL</a></li>
<li><a href="#Бэкап">Бэкап</a></li>
<li><a href="#Маркировка версий">Маркировка версий</a></li>
<li><a href="#Переменные">Переменные</a></li>
<li><a href="#Подключение новостей">Подключение новостей</a></li>
<li><a href="#Примеры">Примеры</a></li>
<li><a href="#Оптимизация скрипта">Оптимизация скрипта</a></li>
<li><a href="#rUFUs / Управление УРЛами">rUFUs / Управление УРЛами</a></li>
<li><a href="#Возможные ошибки rUFUs">Возможные ошибки rUFUs</a></li>
<li><a href="#Плагины">Плагины</a></li>
<li><a href="#Функции">Функции</a></li>
<li><a href="#Шаблоны">Шаблоны</a></li>
<li><a href="#Полезные ссылки">Полезные ссылки</a></li>
</ul>
<h1><a name="Информация о скрипте"></a><small><a href="#top">[^]</a></small>&nbsp;Информация о скрипте</h1>
<p>Strawberry - это мощная и несложная в обращении система публикации новостей,построенная на оригинальной разработке <a href="http://cutephp.com">CutePHPTeam</a> и его ветки <a href="http://ajfork.berlios.de">AJ-Fork</a>, использующая в качестве базы данных текстовые файлы или СУБД MySQL. Системныетребования для работы скрипта минимальны, а возможности неограниченны!Вы можете использовать Strawberry для ведения новостной ленты, как онлайн-дневник(блог) или как настоящую систему управления контентом.</p>
<p>Подробную информацию об использовании скрипта можно почитать на <a href="http://strawberry.goodgirl.ru">официальномсайте </a>Strawberry<br>
 Перед тем, как устанавливать скрипт, советуем ознакомиться с <a href="license.txt">лицензионнымсоглашением</a>.<br>
 Все вопросы по использованию скрипта задавайте на <a href="http://strawberry.goodgirl.ru/forum">форуме</a>для пользователей Strawberry</p>
<p>Вы можете поддержать проект Strawberry:
<ul>
 <li>ссылкой на нас (можно и с кнопочкой, которую в любом фомате можно найти на нашем форуме);</li>
 <li>денежными средствами посредством <a href="http://webmoney.ru">WebMoney</a>: <br>
  $ - Z584423619010,<br>
  € - E489862997841,<br>
  R - R435030808543;</li>
 <li><a href="http://smskopilka.ru/?info&id=2927">через сервис sms.копилка</a></li>
 <li>каким-нибудь иным способом</li>
</ul>
</p>
<h1><a name="Системные требования"></a><small><a href="#top">[^]</a></small>&nbsp;Системные требования</h1>
<ul>
 <li> Минимальные требования:</li>
 <ul>
  <li> Для нормальной работы необходимо наличие <a href="http://php.net">PHP</a> версии4.1.0 и выше.</li>
 </ul>
 <li> Дополнительные требования (необязательные):</li>
 <ul>
  <li> Для создания уменьшеных копий картинок необходимо наличие библиотеки <a href="http://www.boutell.com/gd/">GD2</a>.</li>
  <li> Для полноценного ЧПУ (mod_rewrite = &quot;yes&quot;) необходимо наличие модуля mod_rewrite (модуль для <a href="http://apache.org">Apache</a>).</li>
  <li> Для работы Strawberry с MySQL нужен, извините, <a href="http://mysql.com">MySQL</a> :).</li>
 </ul>
</ul>
<p>Take it, use it, love it! (это тонкий юмор)</p>
<h1><a name="Установка  Strawberry"></a><small><a href="#top">[^]</a></small>&nbsp;Установка  Strawberry</h1>
<p><strong>Внимание!</strong> <em>path/to</em> это путь до директории сStrawberry.</p>
<p>Установка Strawberry несложная, следует лишь соблюдать следующие инструкции:</p>
<ol>
 <li>Скачайте последнюю версию скрипта</li>
 <li>Распакуйте архив во временную папку</li>
 <li>Загрузите все файлы из временного каталога на сервере </li>
 <li>При помощи FTP-клиента выставьте необходимые права на чтение файлов</li>
 <ul>
  <li>CHMOD 777 для папки cache/</li>
  <li>CHMOD 777 для папки backup/</li>
  <li>CHMOD 755 для папки data/ и CHMOD 777 для <em>всех</em> подпапок директории data/ и <em>всех</em> файлов внутри них</li>
  <li>CHMOD 755 для папки data/tpl/ и <em>всех</em> подпапок и CHMOD 644 для файлов внутри них</li>
  <li>CHMOD 644 для файла index.php</li>
 </ul>
 <li>Откройте http://example.com/path/to/index.php в любом браузере иследуйте инструкциям</li>
</ol>
<p>При установки могут возникнуть проблемы. Если инсталяция прервалась (выпоймёте это, страница не загрузится до конца :)) это, конечно, плохо.Это значит что у вашего хостера стоит Safe Mode включённым.<br>
 Вам нужно вручную создать папку <strong>base</strong> в директории data/db/и поставить на base CHMOD 777. Теперь снова попытайтесь проинсталироватьскрипт.</p>
<h1><a name="Переезд с CuteNews.RU 02x, CuteNews и AJ-Fork"></a><small><a href="#top">[^]</a></small>&nbsp;Переезд с CuteNews.RU 02x, CuteNews и AJ-Fork</h1>
<p>Переезд для версий CuteNews.RU 024, 025, 026, 027, 028, 029, оригинального CuteNews и AJ-Fork. Если AJ-Fork версии 168, то Вам сначало нужно запустить tools/anticonvert.php (входит в дистрибутив AJ-Fork) и только потом использовать наш переезд.</p>
<ol>
 <li>Проинсталируйте скрипт</li>
 <li>Скиньте в папку path/to/convert/02x свою старую папку data</li>
 <li>На все файлы *.tmp проставьте CHMOD 777</li>
 <li>Наберите в браузере http://example.com/path/to/convert/</li>
 <li>Выбирайте &quot;02x series to 03x series&quot;</li>
 <li>Выбирайте чего переносить из старой базы (некоторые пункты будут недоступны, пока не перенесены новости) </li>
 <li>После перенесите шаблоны в папку data/tpl, папку с картинками и юзерпиками тоже переместите на новое место
</ol>
<p>Для версий CuteNews.RU выше 030 или версий Strawberry скрипт делает всё сам, если понадобится. Вы просто должны зайти в админку.</p>
<h1><a name="Обновление скрипта"></a><small><a href="#top">[^]</a></small>&nbsp;Обновление скрипта</h1>
<ol>
 <li>Сделайте бекап базы и папки data/</li>
 <li>Распакуйте дистрибутив во временный каталог</li>
 <li>Удалите из временного каталога папку data/</li>
 <li>Залейте всё из временного каталога на сервер</li>
 <li>Зайдите в админку</li>
</ol>
<p>При апгрейде, помимо папок inc и plugins, обновляйте и директорию skins. Не забывайте и про все файлы в главной директории скрипта, файлы в ней (head.php, show_news.php, xmlrpc.php и т.д.) меняются постоянно, если вы не можете изменить их вручную, т.е. довести до &quot;кондиции&quot; новой версии, то перезаписывайте. В противном случае могут возникнуть проблемы. </p>
<p>Чтобы не возникло разного рода проблемпосле обновления скрипта, делайте <a href="#backup">бэкап</a>. Вобще всегда при удобном случае делайте бэкап и качайте его, либо посылайте на e-mail. В крайнем случае, оставляйте лежать архив на сервере. Таким образом вы сбережёте себе нервы и волосы в разных забавных местах.</p>
<h1><a name="Миграция с txtSQL (тектовой версии) на MySQL"></a><small><a href="#top">[^]</a></small>&nbsp;Миграция с txtSQL (тектовой версии) на MySQL</h1>
<ol>
 <li>Сделайте бекап директории data/ и базы </li>
 <li>Наберите в браузере http://example.com/path/to/convert/</li>
 <li>Выбирайте &quot;txtSQL to MySQL&quot;</li>
 <li>Следуйте инструкции</li>
</ol>
<p>Будьте осторожны, миграция работает хреново, например, если вы установите плагин "Кейворды", то считайте кирдык, работать нормально не будет.</p>
<h1><a name="Бэкап"></a><small><a href="#top">[^]</a></small>&nbsp;Бэкап</h1>
<p>Периодически следует делать бэкап данных, потому что в случае сбоя работы сервера вы можете потерять данные. Для этого существует директория backup/. Вам нужно набрать в браузере http://example.com/path/to/index.php?mod=backup и выбрать что бэкапить. Лучше всего сразу делать резервную копию и базы, и папки data/. Вы всегда можете удалить бэкап, скачать его или выслать на e-mail (тот, на который приходят комментарии).</p>
<p>Бэкап данных рекомендуется делать инимум раз в месяц, а также перед апгрейдом скрипта.</p>
<h1><a name="Маркировка версий"></a><small><a href="#top">[^]</a></small>&nbsp;Маркировка версий</h1>
<p>Нынешняя маркировка сделана исходя из следующего: версия точка сборка точка билд. Например версия <em>2</em> сборка <em>3</em> билд <em>2</em> = <strong>2.3.2</strong>.Если билд не указан, значит он равен нулю (2.3 = 2.3.<strong>0</strong>).</p>
<p>У версий, которые на релиз явно не тянут есть буквенная приписка определяющая статус: alfa, beta.</p>
<p>Версии в статусе альфы использовать крайне нежелательно. На них мы не даем никакой гарантии. У новой сборки альфы может меняться всё. Беты использовать можно, но на свой страх и риск. И после релиза нужно апгрейдиться в обязательном порядке!<br>
 Версии у которых есть какая-либо из вышеперечисленных добавлений служат первым делом для тестов и устранения ошибок.</p>
<h1><a name="Переменные"></a><small><a href="#top">[^]</a></small>&nbsp;Переменные</h1>
<p>В базовой сборке (это без учёта подключённых плагинов, у них есть своиописания) существует несколько важных переменных, которые помогут Вамуправлять выводом скрипта и настроить его именно под ваши надобности.</p>
<p class="code"><strong>$static['переменная'] = ЗНАЧЕНИЕ;</strong> // даётпонять скрипту, что полные новости открываться <em>не</em> будут. Этополезно использовать для нескольких подключений. <em>переменная</em>это одна из нижеперечисленных только без знака доллара ($) в начале. Например$static['number'] = 4;</p>
<p class="code"> $<strong>template = 'ШАБЛОН';</strong> // позволяет подключитьопределённый шаблон. Например $template = 'Headlines'. Если вы хотитеиспользовать шаблон Default, то определять эту переменную не нужно. Шаблонставиться по умолчанию.</p>
<p class="code"> <strong>$category = 'ID КАТЕГОРИИ;'</strong> // этой переменнойвы показываете новости какой категории должны выводиться. Можно указыватьнесколько категорий: $category = '1,4,7' это значит выводиться новостибудут только из категорий с ID 1, 4 и 7. ID категорий можно посмотретьв админке -&gt; Категории.</p>
<p class="code"> <strong>$number = КОЛ-ВО;</strong> // этим вы указываетесколько должно выводиться новостей за раз. К примеру, $number = 7.</p>
<p class="code"> <strong>$year</strong>, <strong>$month</strong>, <strong>$day</strong>,<strong>$user</strong> (или <strong>$author</strong>) похожи на переменную $category,только указать можно лишь одно правило. То есть вывод новостей определённогопользователя ($user/$author), за определённый год ($year), месяц ($month),день ($day). Конечно, всё можно использовать &quot;вкупе&quot;: показатьновости определённого пользователя из нужной категории (категорий), некогогода, месяца и дня.</p>
<p class="code"> <strong>$skip = КОЛ-ВО;</strong> // эта переменная должнаиспользоваться только, если задействована переменная $number. Переменная переменная $skip позволяет показыватьновости пропуская энное количество, которое и указывается в переменная $skip.</p>
<p class="code"><strong>$post</strong> // работает <em>только</em> если какая-то новость открыта. Это массив содержащий в себе всю информацию из открытой новости ($post['title'], например, заголовок новости).</p>
<p class="code"> <strong>$sort = array('поле', 'порядок');</strong> // сортируетновости по &quot;полю&quot; по &quot;порядку&quot;.</p>
<p class="code"><strong>$link = 'ФАИЛ';</strong> // заставляет новости (календарь, категории, etc.) открываться в ФАЙЛЕ. Если $link не указан, то подразумевается home (домашняя страница сайта). Обратите внимание на то, что это не абы какой фаил, а &quot;фаил&quot; прописанный в urls.ini. Подробнее об этом читайте в <a href="#rufus">rUFUs / Управление УРЛами</a></p>
<p>Существует так же несколько уже определённых массивов.</p>
<p class="code"><strong>$users </strong>-<strong> </strong> содержит в себе всю информацию о всех пользователях. $users[username]['icq'], где username это логин пользователя, даст ICQ юин пользователя.</p>
<p class="code"><strong>$categories</strong> - содержит всю информацию о категориях. $categories[id]['parent'], где id это ID категории, вернёт &quot;родителя&quot; категории.</p>
<p class="code"><strong>$member</strong> - содержит всю информацию о авторизированном пользователе. $member['icq'] вернёт ICQ юин пользователя.</p>
<p> Доступные значения у переменных $sort и $post:<br>
 <strong>date</strong> - дата новости<br>
 <strong>author</strong> (<em>не</em> user) - пользователь (его логин)<br>
 <strong>title</strong> - заголовок<br>
 <strong>short</strong> - кол-во знаков в короткой новости<br>
 <strong>full</strong> - кол-во знаков в полной новости<br>
 <strong>category</strong> - категория (в базе категории идут как id1,id2и т.д.)<br>
 <strong>url</strong> - заголовок в транслите или слово указанное в поле&quot;УРЛ&quot; при добавлении/редактировании новости<br>
 <strong> id</strong> - идентификационный номер новости<br>
 <strong>views</strong> - счётчик просмотров<br>
 <strong>comments</strong> счётчик комментариев</p>
<p>Порядков сортировки у $sort всего два (но зато каких! :)):<br>
 <strong>ASC</strong> - (ASCENDING) сортирует по возрастанию<br>
 <strong>DESC</strong> - (DESCENDING) сортирует по убыванию.</p>
<p>Например $sort = array('comments', 'DESC') - будет сортировать комментариив порядке &quot;новые сверху&quot;.</p>
<p>Обратите внимание. Всё вышеуказаное может быть расширено плагинами, такими как Keywords, например.</p>
<h1><a name="Подключение новостей"></a><small><a href="#top">[^]</a></small>&nbsp;Подключение новостей</h1>
<p>Это очень простой процесс. Нужно лишь наверх файла, в котором будут отображатьсяновости написать:</p>
<p class="code">include 'path/to/head.php';</p>
<p><strong>Обратите внимание.</strong> <em>path/to/</em> это путь к директории,где расположен скрипт.</p>
<p>&quot;Верх&quot; файла это самый-самый верх. Если есть DOCTYPE, то до него:</p>
<p class="code">&lt;? include 'path/to/head.php';?&gt;<br>
 &lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.0 Transitional//EN&quot;&gt;</p>
<p>Теперь вы поняли что такое &quot;верх&quot;. Да? ;)</p>
<p>А там, где вы хотите видеть сами новости:</p>
<p class="code">include rootpath.'/show_news.php';</p>
<p>Все указанные выше переменные нужно писать <em>до</em> подключения (include)show_news.php:</p>
<p class="code">$number = 7;<br>
 include rootpath.'/show_news.php';</p>
<p>Можно подключать любое количество show_news.php, просто не забудьте использоватьпеременную $static для подключений, которые не должны показывать полную новость.</p>
<p>Вы можете вместо переменной $cutepath использовать константу rootpath:</p>
<p class="code">include rootpath.'/show_news.php';</p>
<h1><a name="Примеры"></a><small><a href="#top">[^]</a></small>&nbsp;Примеры</h1>
<p>Конечно, самый лучший пример это http://ваш-сайт.ру/example/, так как он &quot;боевой&quot;:).</p>
<p>Обычное подключение. Выведет абсолютно все новости, из всех категорий,с сортировкой по умолчанию (сортировка по дате, по убыванию (DESC), т.е. новыесверху):</p>
<p class="code"> include rootpath.'/show_news.php';</p>
<p>Теперь нам нужно вывести 5 новостей из категории &quot;Вася&quot; (унеё ID, предположим, 1) и Гриша (ID этой 4) с шаблоном Headlines:</p>
<p class="code">$number = 5;<br>
 $category = '1,4';<br>
 $template = 'Headlines';<br>
 include rootpath.'/show_news.php';</p>
<p>Отлично. Сейчас задача следующая: если кто-то открыл полную новость,надо снизу (можно и сверху - без разницы) вывести несколько (7) новостей из той же категории, что и открытая.Шаблон будет Headlines:</p>
<p class="code">$number = 5;<br>
 include rootpath.'/show_news.php'; <br>
 <br>
 if ($post['category']){ // узнаём, открыта ли какая-то новость и в категориили она вообще<br>
 &nbsp;&nbsp;&nbsp;$static['skip'] = 0;<br>
 &nbsp;&nbsp;&nbsp;$static['template'] = 'Headlines';<br>
 &nbsp;&nbsp;&nbsp;$static['number'] = 7;<br>
 &nbsp;&nbsp;&nbsp;$static['category'] = $post['category'];<br>
 &nbsp;&nbsp;&nbsp;include rootpath.'/show_news.php'; <br>
 }</p>
<p>Если не нужно выводить из той же категории, а просто 7 заголовков, то делать это следует так:</p>
<p class="code"> $static['skip'] = 0;<br>
 $static['template'] = 'Headlines';<br>
 $static['number'] = 7;<br>
 include rootpath.'/show_news.php'; </p>
<h1><a name="Оптимизация скрипта"></a><small><a href="#top">[^]</a></small>&nbsp;Оптимизация скрипта</h1>
<p>Плагины и некоторые функции лишний раз обращаются к базе и создают нагрузку, плюс есть функция создающая ужасное PGT (время генерации скрипта)(я работаю над её оптимизацией). Для ускорения работы скрипта и снижения нагрузки на сервер нужно использовать кэширование. По умолчанию оно выключено, включить можно в настройках системы -&gt; закладка &quot;система&quot; -&gt; поле &quot;Кэш&quot;.</p>
<h1><a name="rUFUs / Управление УРЛами"></a><small><a href="#top">[^]</a></small>&nbsp;rUFUs / Управление УРЛами</h1>
<p>С помощью rUFUs вы можете настраивать УРЛы скрипта исходя из личных предпочтений.</p>
<p><strong>Обратите внимание!</strong> Все примеры ниже предпологают домашнюю страницу сайта <em>http://example.com/index.php</em>, а "Полный путь к директории, где установлена Strawberry" это http://example.com/path/to</p>
<p>В дистрибутиве по умолчанию идут УРЛы следующие:<br>
 для новостей http://example.com/index.php?id=ID<br>
 для категорий http://example.com/index.php?category=ID<br>
 и так далее.</p>
<p>Не то чтобы этот вариант был ужасен, нет, поисковики (по крайней мере <a href="http://ya.ru">нормальные</a> <a href="http://google.com">поисковики</a> :)) &quot;кушают&quot; такие страницына &quot;ура&quot;, проблемы могут быть у пользователей шастающих по вашему венцу творения. Сами посудите, что проще запомнить и в чём ориентироваться.</p>
<p>К примеру, есть у нас биография господина Ремарка: &quot;Эрих Мария Ремарк. Биография&quot;. УРЛ http://example.com/index.php?id=128 об этом ничего не говорит. А вот http://example.com/bio/remark (bio это категория) или http://example.com/remark.html - да. Согласитесь, это логичные УРЛы. Пользователь набирая первые буквы вашего сайта и видя все странички, которые посетил сразу поймёт что про что и зачем. Это называется <a href="http://spectator.ru/technology/php/user_friendly_urls">ЧПУ</a> (человеко-понятные УРЛы).</p>
<p>Выучить синтаксис труда не составит, тем более, если вы ковыряли когда-нибудь ini-файлы, а вот с пониманием и моим объяснением проблемы возникнуть могут. Я попробую как можно проще и доходчивея объяснить что к чему и почему. Чтобы не показывать на пальцах, советую проинсталировать скрипт и для начана поработать с http://example.com/path/to/example. Так же советую сделать бэкап файла data/urls.ini на всякий случай. Если в процессе вылезет ошибка 500, то просто удалите фаил .htaccess из http://example.com/path/to/example (да, он сохраняется в домашнюю директорию сайта).</p>
<p>Итак, для начала разберём дефолтные настройки.</p>
<p class="code">[home]<br>
 post = "?id={id}"<br>
 category = "?category={category-id}"<br>
 user = "?do=users&user={user}"<br>
 day = "?year={year}&month={month}&day={day}"<br>
 month = "?year={year}&month={month}"<br>
 year = "?year={year}"<br>
 <br>
 [rss.php]<br>
 post = "?id={id}"<br>
 category = "?category={category-id}"<br>
 user = "?user={user}"<br>
 <br>
 [print.php]<br>
 post = "?id={id}"<br>
 <br>
 [trackback.php]<br>
 post = "?id={id}"</p>
<p>post, category, user, day, month и year это стандартные ключи их описание можно посмотреть чуть ниже. Описание {тегов} рядышком со значениями :). Я думаю, с этим, более менее всё понятно. Есть ключ post мы делаем ему маску.</p>
<p><em>?id={id}</em> в итоге даст <em>http://example.com/index.php?id=128</em> (128 это пример, конечно же).</p>
<p>Странные штуковины в квадратных скобках это файлы через которые идёт обработка. [home] это &quot;Домашняя директория сайта&quot;, сейчас она у нас <em>http://example.com/index.php</em> (это тут, в ридми), а [rss.php] это <em>http://example.com/path/to/rss.php</em>, [print.php] - <em>http://example.com/path/to/print.php</em>, [trackback.php] - <em>http://example.com/path/to/trackback.php</em>.</p>
<p>Если нужно чтобы обработка шла не через аддон (файлы в директории скрипта типа rss.php) или какой-то ваш фаил в директории скрипта, а в директории сайта, то нужно писать так:</p>
<p class="code">[home/file.php]</p>
<p>эта штука поможет сделать ссылку на http://example.com/<em>file.php</em>.</p>
<p>Такая:</p>
<p class="code">[home/folder]</p>
<p> на http://example.com/<em>folder</em>.</p>
<p>А такая:</p>
<p class="code">[home/folder/file.php]</p>
<p> на http://example.com/<em>folder/file.php</em>.</p>
<p>Вызывать сгенерированные УРЛы нужно через <em>$tpl['post']['link']['ключ']</em>, например $tpl['post']['link']['post'] в таком случае ссылка будет формироваться за счёт переменной $link (см. <a href="#variables">переменные</a>), либо через $tpl['post']['фаил/ключ'], например, <em>$tpl['post']['home/post']</em> это фиксированный выбор, переменная $link не сможет ничего изменить. Впрочем, это работает только в шаблонах, я имею в виду переменную $tpl. В друших местах сайта нужно вызывать функцию straw_get_link(). Работает она схоже:</p>
<p class="code">straw_get_link(массив, ключ, фаил)</p>
<p>К примеру, делаем выборку из таблицы news и выводим заголовки, которые ещё и ссылки работающие через home/file.php и ключ post:</p>
<p class="code">foreach ($sql-&gt;select(array('table' =&gt; 'news'))) as $row){<br>
 echo '&lt;a href=&quot;'.straw_get_link($row, 'post', 'home/file.php').'&quot;&gt;'.$row['title'].'&lt;/a&gt;&lt;br /&gt;'; <br>
 }</p>
<p>Все примеры далее полностью работают, если ваш хостер поддерживает mod_rewrite. Спросите у него и если это верно, то зайдите в настройки системы и в пункте &quot;mod_rewrite&quot; поставьте &quot;Да&quot;. </p>
<p>Итак. Давайте попробуем сделать ЧПУ для постов, нужно сделать вид <em>год/месяц/день/заголовок.html</em> и выводить через домашнюю страницу сайта). Сделать это просто. Сначало следует зайти в &quot;Управление УРЛами&quot;. В окне .htaccess следует в [home] заменить:</p>
<p class="code">post = "?id={id}"</p>
<p>на вот это: </p>
<p class="code">post = &quot;{year}/{month}/{day}/{title}.html&quot;</p>
<p>Теперь нажать &quot;Сохранить urls.ini&quot;, а затем &quot;Создать .htaccess&quot;. Всё. Теперь откроте сайт и тыкните на УРЛ. Если вылезла ошибка 404, то поробуйте зайти в домашнюю страницу сайта по FTP и проверить, есть ли .htaccess. Если нет - не беда. Создайте его и поставьте права 666 или 777. Теперь снова сгенерируйте .htaccess. Если и сейчас 404, то спросите хостера ещё раз про mod_rewrite. Может наврал гадюка?</p>
<p>Сейчас попробуем переделать имя файла. К примеру, чтобы наш RSS был по адресу <em>http://example.com/rss.xml</em>, а не http://example.com/path/to/rss.php. Вы ведь можете сменить директорию скрипта, переименовать и т.д., да и просто хочется сделать более симпатичный УРЛ.</p>
<p>Под [rss.php] пишем:</p>
<p class="code">post = &quot;{year}/{month}/{day}/{title}.html&quot;</p>
<p>Сохраняем urls.ini, генерируем .htaccess и заходим на http://example.com/rss.xml. Какая прелесть, работает и кто бы мог подумать?</p>
<p>Обратите внимание, мы сделали новый ключ с иминем feed. Это имя произвольно. Вы можете называть как хотите, главное чтобы ваше имя не перебивало стандартные ключи (post, category, user, day, month и year).</p>
<p>Всё оки, а что делать, если сайт раотает через какие-то переменые, т.е. их нужно передать скрипту? Всё оки-доки. Передать свои переменные можно двумя путями: скрытым и публичным. К примеру, есть у нас переменная kartman. Если она равна news (kartman=news), то открываются новости, иначе кукиш, не будут выводиться. Делаем так.</p>
<p>Первый путь. Путь <s>ниндзя</s> скрытый. В {тег} можно добавлять данные.</p>
<p>Так {тег:kartman=news}:</p>
<p class="code">post = &quot;{year}/{month}/{day}/{title:kartman=news}.html&quot;</p>
<p> или так {тег}{add:kartman=news}:</p>
<p class="code">post = &quot;{year}/{month}/{day}/{title}.html{add:kartman=news}&quot;</p>
<p>Если нужно передать несколько параметров, то пишим не <em>kartman=news</em>, а например <em>kartman=news&amp;some=thing&amp;and=more</em> - в этой строке передаём переменные kartman, some и and.</p>
<p>В УРЛ эти данные не попадут. Поэтому способ и именуется скрытый. В бубличном всё капельку иначе:</p>
<p class="code">post = &quot;{year}/{month}/{day}/{title}.html?kartman=news&quot;</p>
<p><em>?kartman=news</em> попадёт в УРЛ.</p>
<p>Иногда нужно делать статичные файлы. Например, по адресу http://example.com/category иметь список категорий, а по http://example.com/archives список архивов. Загляните в фаил exapmle/index.php (лежит в директории со скриптом) и увидите как там реализовано:</p>
<p class="code">if ($do == 'search'){<br>
 // выводим поиск (аддон)<br>
 $number = 12;<br>
 include rootpath.'/show_search.php';<br>
 } elseif ($do == 'users'){<br>
 // выводим список юзерей (аддон)<br>
 include rootpath.'/show_users.php';<br>
 } elseif ($do == 'category'){<br>
 // выводим список категорий (плагин CN Functions)<br>
 echo cn_category();<br>
 } elseif ($do == 'archives'){<br>
 // выводим список архивов (плагин CN Functions)<br>
 echo cn_archives();<br>
 } else {<br>
 // выводим семь новостей<br>
 $number = 7;<br>
 include rootpath.'/show_news.php';<br>
 }</p>
<p>По-русски это звучит так: если переменная do равна search, то делаем это, если равна users... и так далее до несовпадения ни с чем, тогда выводим новости. Но зачем нам УРЛ http://example.com/index.php?do=category, когда можно http://example.com/category? Правильно, незачем.</p>
<p>Поэтому определяемся с файлом (в примеру будет домашняя страница сайта), берём все свои do и пишем под [home]:</p>
<p class="code">doIt = &quot;(search|users|category|archives){add:do=$1}&quot;</p>
<p>Сохраняем и генерируем. Всё. Теперь у нас есть виртуальные папки. Ну не крутатня ли? :)</p>
<p>Видимо, нужно немного пояснить. Дело в том, что {add:что-то}добавляет ?что-то в конец, т.е. что мы будем реврайтить. (что-то|что-то другое) говорит мод_реврайту &quot;или&quot;, т.е. что-то или &quot;что-то другое&quot;. Знак цифра со знаком доллара определяет последовательность. Вот смотрите, если у нас есть:</p>
<p class="code">(что-то раз|что-то другое раз)(что-то два|что-то другое два)</p>
<p>то всё что между первыми скобками это $1, всё что между вторыми это $2.</p>
<p>Вот пример, он не рабочий (из-за кирилицы), это просто пример: </p>
<p class="code">чтоТо = &quot;(что-то раз|что-то другое раз)(что-то два|что-то другое два){add:чтоРаз=$1&amp;чтоДва=$2}&quot;</p>
<p>Соблюдать последовательность необязательно:</p>
<p class="code">чтоТо = &quot;(что-то раз|что-то другое раз)(что-то два|что-то другое два){add:чтоРаз=$2&amp;чтоДва=$1}&quot;</p>
<p class="code">чтоТо = &quot;(что-то раз|что-то другое раз)(что-то два|что-то другое два){add:чтоДва=$2&amp;чтоРаз=$1}&quot;</p>
<p class="code">чтоТо = &quot;(что-то раз|что-то другое раз)(что-то два|что-то другое два){add:чтоДва=$1&amp;чтоДва=$2}&quot;</p>
<p>Лучше всего, конечно, почитать что-ибудь про <a href="http://www.google.com.tr/search?q=regexp&hl=ru&lr=lang_ru&sa=X&oi=lrtip9">regexp</a>`ы. Если вы имели дело с каким-то языком программирования или непосредственно с mod_rewrite, то сталкивались с регулярными выражениями.</p>
<p>Список ключей:</p>
<p class="code"><strong>post</strong> - ссылка на новость (переменная id) <br>
 <strong>category</strong> - ссылка на категорию (переменная category)<br />
 <strong>user</strong> - ссылка на пользователя (переменная user) <br />
 <strong>day</strong> - ссылка на день (переменная day) <br />
 <strong>month</strong> - ссылка на месяц (переменная month) <br />
 <strong>year</strong> - ссылка на год (переменная year)</p>
<p>Переменные указаные в скобочках говорят какой, собственно, переменной передаются параметры срипту.</p>
<p>Список тегов:</p>
<p class="code"><strong>{id}</strong> - ID новости (цифры)<br />
 <strong>{year}</strong> - год публикации новости (1980, 1983, 2004, 2005 и т.д.)<br />
 <strong>{month}</strong> - номер (от 01 до 12) месяца публикации новости<br />
 <strong>{Month}</strong> - имя месяца (от jan до dec) публикации новости<br />
 <strong>{day}</strong> - день (от 01 до 31) публикации новости<br />
 <strong>{title}</strong> - заголовок новости(в транслите или присвоенное ей название в поле &quot;УРЛ&quot;)<br />
 <strong>{user}</strong> - автор новости<br />
 <strong>{user-id}</strong> - ID автора новости (цифры)<br />
 <strong>{category-id}</strong> - ID категории (цифры)<br />
 <strong>{category}</strong> - имя категории (в транслите или присвоенноеей название в поле &quot;УРЛ&quot;)<br />
 <strong>{categories}</strong> - категория со всеми parent`ами, т.е. /категория/суб/наша-категория (цифры)</p>
<h1><a name="Возможные ошибки rUFUs"></a><small><a href="#top">[^]</a></small>&nbsp;Возможные ошибки rUFUs</h1>
<p>Первая и самая распространённая ошибка - не создаётся .htaccess. Вам нужно самостоятельно в &quot;домашней странице сайта&quot; создать .htaccess с CHMOD 666. А потом снова создать его из админки.</p>
<p>Вторая. Если вы захотите написать УРЛ для категорий:</p>
<p class="code">category = &quot;{categories}&quot;</p>
<p>Будут некоторые проблемы. Они связаны с mod_rewrite.Тег {categories} оставляет следующее условие для реврайта:</p>
<p class="code">([/_0-9a-z-]+)</p>
<p>Оно подходит почти под всё: тут и цифры разрешены, и буквы, и минус снижмим подчёркиванием, и даже слэш. Что может помочь? Иерархия, конечноже.</p>
<p class="code">[home]<br />
 post = &quot;{year}/{month}/{day}/{title}.html&quot;<br />
 user = &quot;users/{user}.html&quot;<br />
 day = &quot;{year}/{month}/{day}&quot;<br />
 month = &quot;{year}/{month}&quot;<br />
 year = &quot;{year}&quot;<br>
 <strong>category = &quot;{categories}&quot;</strong><br />
 <br>
 [rss.php]<br />
 post = &quot;{year}/{month}/{day}/{title}.xml&quot;<br />
 category = &quot;category/{categories}/rss.xml&quot;<br />
 user = &quot;users/{user}.xml&quot;<br />
 <br>
 [print.php]<br />
 post = &quot;{year}/{month}/{day}/{title}.phtml&quot;<br />
 <br>
 [trackback.php]<br />
 post = &quot;{year}/{month}/{day}/{title}.tb&quot;</p>
<p>Видите, пункт category перемещён как можно ниже, mod_rewrite (именно, как мод Апача, а не пункт в настройках :)) будет егообработать в последнюю очередь и возможно(!) это позволит избежать ошибоки неожиданностей.<br>
 <strong>upd</strong>данная ошибка была исправлена в версиях выше 2.5.4, но подобная ошибка может встречатся и с правилами пользователей, которые я, к сожалению, предвидеть не могу. Поэтому &quot;на заметку&quot; оставляю.<br>
 <strong>upd2</strong> вот пример чего я не могу предвидить:</p>
<p class="code">[home]<br />
 post = &quot;{categories}/{title}&quot;<br />
 category = &quot;{categories}&quot;<br>
 user = &quot;users/{user}.html&quot;<br />
 day = &quot;{year}/{month}/{day}&quot;<br />
 month = &quot;{year}/{month}&quot;<br />
 year = &quot;{year}&quot;</p>
<p>Посмотрите на post и category. Такие правила вызывут &quot;Новость не найдена&quot; при просмотре категории с большой вложенность. Исправить ошибку просто, нужно поменять местами post и category:</p>
<p class="code">[home]<br />
 category = &quot;{categories}&quot;<br>
 post = &quot;{categories}/{title}&quot;<br />
 user = &quot;users/{user}.html&quot;<br />
 day = &quot;{year}/{month}/{day}&quot;<br />
 month = &quot;{year}/{month}&quot;<br />
 year = &quot;{year}&quot;</p>
<p><strong>Для очень умных людей:</strong> скрипт формирует правила для mod_rewrite, скрипт обрабатывает то, что даёт ему мод Апача.</p>
<p>Третья. Если вылезет ошибка 500, то нужно зайти по ftp и удалить .htaccess. Потом обязательно необходимо проверить категории. Скорее всего, одна из них без имени! Или вы гсохраняете .htaccess с УРЛами вида &quot;как в старые добрые времена. Этого не допускается.</p>
<h1><a name="Плагины"></a><small><a href="#top">[^]</a></small>&nbsp;Плагины</h1>
<p>Хочу рассказать о плагине &quot;Приблуды&quot; (CN functions - с недавнего времени, мультиязычность, извините). Он включает в себя четырефункции: cn_calendar(), cn_title, cn_archives() и cn_category(). Первое это календарь,второе - список архивов и третье - список категорий.</p>
<p>Если вы раньше работали с CuteNews версий 02x, то должны помнить этифункции, только не с префиксом &quot;cn_&quot;, а &quot;rufus_&quot;.Они имели не много функций и достаточно сложно настраивались (в визуальномплане). С тех пор всё несколько изменилось (это не относится к календарю:)).</p>
<p><strong>Обратите внимание!</strong> Это php-функции. Выводить их надо так:</p>
<p class="code">&lt;?=cn_category(); ?&gt;</p>
<p>Со своими настройками так:</p>
<p class="code">&lt;?=cn_category('настройка1', 'настройка2'); ?&gt;</p>
<p><strong>cn_archives()</strong>:</p>
<p class="code">cn_archives([шаблон [, сортировка]])<br>
 - <strong>шаблон</strong>это внешний вид, доступны теги:<br>
 &nbsp;&nbsp;{count} (кол-во новостей за месяц), {date} (например Апрель 2005), <br>
 &nbsp;&nbsp;{link} (ссылка, например /2005/04/,настроить вид ссылки можно в urls.ini фаил - [home], тип - month). <strong><br>
 -сортировка</strong>это, собственно, сортировка, аналог переменной $sort</p>
<p>С <strong>cn_category()</strong> всё куда сложнее, но и интереснее и разнообразнее:</p>
<p class="code">cn_category([префикс [, шаблон [, нет-префиксу [, уровень]]]])<br>
 - <strong>префикс</strong> это то, что будет идти перед <strong>шаблоном</strong>,но, будет повторяться в зависимоти от вложенности категорий<br>
 -<strong>нет-префиксу</strong>важная штука, она говорит делать ли префикс для категорий-родителей откоторых и начинается вся цепочка подкатегорий<br>
 - <strong>шаблон</strong>- как и в cn_archivev() это внешний вид. Теги следующие:<br>
 &nbsp;&nbsp; {id} - ID категории<br>
 &nbsp;&nbsp; {name} - имя<br>
 &nbsp;&nbsp; {url} - имя в транслите, либо слово указаное в поле &quot;УРЛ&quot;<br>
 &nbsp;&nbsp; {icon} - иконка категории<br>
 &nbsp;&nbsp; {prefix} - это префикс, который вы указали в поле &quot;префикс&quot;. <br>
 &nbsp;&nbsp;[php][/php], между этими тегами можноставить php функцию. Вот для примера (это и шаблон по умолчанию): <em>&lt;ahref=&quot;[php]straw_get_link($row, category)[/php]&quot;&gt;{name} ([php]count_category_entry({id})[/php])&lt;/a&gt;&lt;br/&gt;</em>. <strong>уровень</strong> говорит от какого ID категории показывать.Будут показаны все подкатегории указаного ID.</p>
<p>Заметим, что cn_categoy() построена на функции category_get_tree() (о ней можно почитать ниже). Функции для понимания сложной, но в использовании крайне полезной.</p>
<p><strong>cn_title()</strong>:</p>
<p class="code">cn_title([разделитель [, направление]])<br>
 - c <strong>разделителем</strong><br>
 -<strong>направление</strong> указывает &quot;откуда куда&quot; сначала в конец значение false, с конца в начало - true</p>
<p>Ф-ия <strong>cn_calendar()</strong> выводит календар записей. CSS для календаря:</p>
<p class="code"><strong>#calendar</strong> - это id всей таблицы календаря<br>
 <strong>.month</strong> - класс заголовка месяца и ссылок на предыдущий/следующий месяц<br>
 <strong>.weekday</strong> - класс названий дней недели с понедельника по пятницу<br>
 <strong>.day</strong> - класс самих дней с понедельника по пятницу<br>
 <strong>.weekend</strong> - класс названий дней недели субботы и воскресенья<br>
 <strong>.endday</strong> - класс самих дней субботы и воскресенья</p>
<p>Для примера CSS можно привести пример:</p>
<p class="code">#calendar {text-align: center;}<br>
 #calendar .month, #calendar .month a {font-weight: bold;color: #ccc;}<br>
 #calendar .weekday {color: #ccc;}<br>
 #calendar .weekday a {color: #ccc;font-weight: bold;}<br>
 #calendar .day, #calendar .day a {color: #ccc;}<br>
 #calendar .weekend {color: #c60000;}<br>
 #calendar .weekend a {color: #c60000;font-weight: bold;}<br>
 #calendar .endday, #calendar .endday a {color: #c60000;}</p>
<h1><a name="Функции"></a><small><a href="#top">[^]</a></small>&nbsp;Функции</h1>
<p>Все нижеприведенные функции крайне полезны.</p>
<p>straw_get_link() - про неё вы уже знаете: straw_get_link(массив [, типссылки [, фаил]]).</p>
<p>Не менее полезая - category_get_tree() (за счёт этой функции работаетcn_category()). Её пример можно увидеть в search.php. Синтаксис прост:</p>
<p class="code">category_get_tree([префикс [, шаблон [, нет-префиксу [,уровень]]]]) всё абсолютно схоже с cn_category()<br>
 +1 запрос к БД. cn_category() кэшируется, следовательно, запросов нет, а эта функция не кэшируется</p>
<p>Помимо упомянутой выше есть ещё несколько полезных функций для работы с категориями.</p>
<p class="code">category_get_link(id) - <strong>id</strong> это номер категории. Функция даст ссылку со всеми родителями</p>
<p class="code">category_get_children(id) - даст список всех дочерних категорий в виде приемлемом для скрипта (&quot;1,2,3&quot;)</p>
<p class="code">category_get_title(id [, разделитель]) - получает названиее категории из её ID, учитывая все категории-родители. <strong>разделитель</strong> это то, что будет стоять между названиями категорий</p>
<p class="code">category_get_id(категория) - функция даёт номер категории исходя из её названия или УРЛа. <strong>категория</strong> - это, собственно, имя категории или её УРЛ</p>
<p>Остальные функции вы можете посмотреть в inc/functions.inc.php или в <a href="http://strawberry.goodgirl.ru/docs/functions/">документации</a>.</p>
<h1><a name="Шаблоны"></a><small><a href="#top">[^]</a></small>&nbsp;Шаблоны</h1>
<p>Скрипт работает за счёт двух шаблонов. Первый это шаблон самого сайта, т.е. ваш. Куда угодно вы можете сувать подключение новостей. Второй это шаблон новостей. Все они хранятся в папке data/tpl/. Одна директория внутри это один шаблон. Например, Default это шаблон по умолчанию. active.tpl, full.tpl и т.д. это на самом деле PHP-файлы, которые подключаются в коде скрипта и выводят ту или иную информацию. Со всеми переменными вы можете ознакомится в <strong>админке -&gt; шаблоны</strong>. Хочу заметить, все переменные для полной/короткой новости ($tpl['post']) работают и для комментариев, и для формы.</p>
<p>Существует так же шаблон mail, он содержит в себе шаблоны всех писем отправляемых скриптом (плагины не в счёт, у них свои шаблоны, определяет их автор плагина и парсятся (обрабатываются) они так же через плагин). По сути, этот шаблон вынесен для перевода пользователями отличными от русского языков.</p>
<h1><a name="Полезные ссылки"></a><small><a href="#top">[^]</a></small>&nbsp;Полезные ссылки</h1>
<ul>
 <li><a href="http://strawberry.goodgirl.ru/docs/">Документация</a></li>
 <li><a href="http://strawberry.goodgirl.ru/docs/sql/">Справка по SQL-запросам</a> (<a href="http://strawberry.goodgirl.ru/docs/sql.rar">оффлайн версий</a>)</li>
 <li><a href="http://strawberry.goodgirl.ru/docs/functions/">Описание функций скрипта</a> (<a href="http://strawberry.goodgirl.ru/docs/functions.rar">оффлайн версий</a>)</li>
 <li><a href="http://strawberry.goodgirl.ru/forum/">Форум поддержки</a></li>
 <li><a href="http://strawberry.goodgirl.ru/about/support.html">Про персональную поддержку</a></li>
</ul>
</body>
</html>